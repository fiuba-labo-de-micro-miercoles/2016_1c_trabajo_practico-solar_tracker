;-------------------------------------------------------------------------
;
;							MOTORS.inc
;
;-------------------------------------------------------------------------
.CSEG

MOTORS_INIT:
	INPUT AUX,DDRD
	ANDI AUX,(~((1<<DDD5)|(1<<DDD6)))
	ORI AUX,((1<<DDD5)|(1<<DDD6))
	OUTPUT DDRD,AUX

	INPUT AUX,PORTD
	ANDI AUX,(~((1<<MOT_1)|(1<<MOT_2)))
	OUTPUT PORTD,AUX

	CLR	AUX
	OUTPUT	OCR1AL,AUX
	OUTPUT	OCR1AH,AUX
	OUTPUT	OCR1BL,AUX
	OUTPUT	OCR1BH,AUX
RET

MOTOR_AZIMUT_EAST:
;SETEO MOT_1 Y MOT_2
;SETEO LOS ENABLE
;SETEO EL PWM
	INPUT PWM_DATA,TCCR1A	;Timer/counter control register A
	ANDI PWM_DATA,(~((1<<COM1A1)|(1<<COM1B1)|(1<<COM1A0)|(1<<COM1B0)|(1<<WGM10)|(1<<WGM11)))
	ORI PWM_DATA,((1<<COM1A1)|(0<<COM1A0)|(1<<WGM10)|(0<<WGM11))	;fast PWM, non-inverting
	OUTPUT TCCR1A,PWM_DATA

	INPUT AUX,PORTD
	ANDI AUX,(~((1<<MOT_1)|(1<<MOT_2)))
	ORI AUX,((0<<MOT_1)|(1<<MOT_2))			;CHEQUEAR CUANDO SE CONECTE
	OUTPUT PORTD,AUX

	CLR	AUX
	OUTPUT	OCR1AH,AUX
	OUTPUT	OCR1BL,AUX
	OUTPUT	OCR1BH,AUX

	OUTPUT	OCR1AL,AUX1
RET

MOTOR_AZIMUT_WEST:
;SETEO MOT_1 Y MOT_2
;SETEO LOS ENABLE
;SETEO EL PWM
	INPUT PWM_DATA,TCCR1A	;Timer/counter control register A
	ANDI PWM_DATA,(~((1<<COM1A1)|(1<<COM1B1)|(1<<COM1A0)|(1<<COM1B0)|(1<<WGM10)|(1<<WGM11)))
	ORI PWM_DATA,((1<<COM1A1)|(0<<COM1A0)|(1<<WGM10)|(0<<WGM11))	;fast PWM, non-inverting
	OUTPUT TCCR1A,PWM_DATA

	INPUT AUX,PORTD
	ANDI AUX,(~((1<<MOT_1)|(1<<MOT_2)))
	ORI AUX,((1<<MOT_1)|(0<<MOT_2))			;CHEQUEAR CUANDO SE CONECTE
	OUTPUT PORTD,AUX

	CLR	AUX
	OUTPUT	OCR1AH,AUX
	OUTPUT	OCR1BL,AUX
	OUTPUT	OCR1BH,AUX

	OUTPUT	OCR1AL,AUX1
RET

MOTOR_ELEVATION_NORTH:
;SETEO MOT_1 Y MOT_2
;SETEO LOS ENABLE
;SETEO EL PWM
	INPUT PWM_DATA,TCCR1A	;Timer/counter control register A
	ANDI PWM_DATA,(~((1<<COM1A1)|(1<<COM1B1)|(1<<COM1A0)|(1<<COM1B0)|(1<<WGM10)|(1<<WGM11)))
	ORI PWM_DATA,((1<<COM1B1)|(0<<COM1B0)|(1<<WGM10)|(0<<WGM11))	;fast PWM, non-inverting
	OUTPUT TCCR1A,PWM_DATA

	INPUT AUX,PORTD
	ANDI AUX,(~((1<<MOT_1)|(1<<MOT_2)))
	ORI AUX,((1<<MOT_1)|(0<<MOT_2))			;CHEQUEAR CUANDO SE CONECTE
	OUTPUT PORTD,AUX

	CLR	AUX
	OUTPUT	OCR1AL,AUX
	OUTPUT	OCR1AH,AUX
	OUTPUT	OCR1BH,AUX

	OUTPUT	OCR1BL,AUX1
RET

MOTOR_ELEVATION_SOUTH:
;SETEO MOT_1 Y MOT_2
;SETEO LOS ENABLE
;SETEO EL PWM
	INPUT PWM_DATA,TCCR1A	;Timer/counter control register A
	ANDI PWM_DATA,(~((1<<COM1A1)|(1<<COM1B1)|(1<<COM1A0)|(1<<COM1B0)|(1<<WGM10)|(1<<WGM11)))
	ORI PWM_DATA,((1<<COM1B1)|(0<<COM1B0)|(1<<WGM10)|(0<<WGM11))	;fast PWM, non-inverting
	OUTPUT TCCR1A,PWM_DATA

	INPUT AUX,PORTD
	ANDI AUX,(~((1<<MOT_1)|(1<<MOT_2)))
	ORI AUX,((0<<MOT_1)|(1<<MOT_2))			;CHEQUEAR CUANDO SE CONECTE
	OUTPUT PORTD,AUX

	CLR	AUX
	OUTPUT	OCR1AL,AUX
	OUTPUT	OCR1AH,AUX
	OUTPUT	OCR1BH,AUX

	OUTPUT	OCR1BL,AUX1

RET

MOTORS_OFF:
;SETEO MOT_1 Y MOT_2
;SETEO LOS ENABLE
;SETEO EL PWM
	INPUT PWM_DATA,TCCR1A	;Timer/counter control register A
	ANDI PWM_DATA,(~((1<<COM1A1)|(1<<COM1B1)|(1<<COM1A0)|(1<<COM1B0)|(1<<WGM10)|(1<<WGM11)))
	ORI PWM_DATA,((1<<WGM10)|(0<<WGM11))	;fast PWM, non-inverting
	OUTPUT TCCR1A,PWM_DATA

	INPUT AUX,PORTD
	ANDI AUX,(~((1<<MOT_1)|(1<<MOT_2)))
	OUTPUT PORTD,AUX

	CLR	AUX
	OUTPUT	OCR1AL,AUX
	OUTPUT	OCR1AH,AUX
	OUTPUT	OCR1BL,AUX
	OUTPUT	OCR1BH,AUX
RET