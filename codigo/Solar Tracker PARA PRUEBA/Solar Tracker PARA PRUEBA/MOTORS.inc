;-------------------------------------------------------------------------
;
;							MOTORS.inc
;
;-------------------------------------------------------------------------
.CSEG

MOTORS_INIT:
	INPUT AUX,DDRD
	ANDI AUX,(~((1<<DDD5)|(1<<DDD6)))	;Mascara para tocar solo D3
	ORI AUX,((1<<DDD5)|(1<<DDD6))
	OUTPUT DDRD,AUX
	RCALL MOTOR_AZIMUT_OFF
	RCALL MOTOR_ELEVATION_OFF
RET

MOTOR_AZIMUT_LEFT:
;SETEO LOS ENABLE
;SETEO EL PWM
	INPUT AUX,PORTB
	ANDI AUX,(~((1<<MOTOR_EN_A)|(1<<MOTOR_EN_B)))
	ORI AUX,((1<<MOTOR_EN_A)|(0<<MOTOR_EN_B))			;CHEQUEAR CUANDO SE CONECTE
	OUTPUT PORTB,AUX

	LDI PWM_DATA,PWM_AZIMUT_DEFAULT
	SPWM MOTOR_AZIMUT,PWM_DATA
RET

MOTOR_AZIMUT_RIGHT:

	INPUT AUX,PORTB
	ANDI AUX,(~((1<<MOTOR_EN_A)|(1<<MOTOR_EN_B)))
	ORI AUX,((0<<MOTOR_EN_A)|(1<<MOTOR_EN_B))			;CHEQUEAR CUANDO SE CONECTE
	OUTPUT PORTB,AUX
	
	LDI PWM_DATA,PWM_AZIMUT_DEFAULT
	SPWM MOTOR_AZIMUT,PWM_DATA
RET

MOTOR_AZIMUT_OFF:
	CLR AUX
	RPWM MOTOR_AZIMUT
RET

MOTOR_ELEVATION_UP:

	INPUT AUX,PORTB
	ANDI AUX,(~((1<<MOTOR_EN_A)|(1<<MOTOR_EN_B)))
	ORI AUX,((1<<MOTOR_EN_A)|(0<<MOTOR_EN_B))			;CHEQUEAR CUANDO SE CONECTE
	OUTPUT PORTB,AUX
	
	LDI PWM_DATA,PWM_ELEVATION_DEFAULT
	SPWM MOTOR_ELEVATION,PWM_DATA
RET

MOTOR_ELEVATION_DOWN:

	INPUT AUX,PORTB
	ANDI AUX,(~((1<<MOTOR_EN_A)|(1<<MOTOR_EN_B)))
	ORI AUX,((0<<MOTOR_EN_A)|(1<<MOTOR_EN_B))			;CHEQUEAR CUANDO SE CONECTE
	OUTPUT PORTB,AUX
	
	LDI PWM_DATA,PWM_ELEVATION_DEFAULT
	SPWM MOTOR_ELEVATION,PWM_DATA
RET

MOTOR_ELEVATION_OFF:
	CLR AUX
	RPWM MOTOR_ELEVATION
RET
